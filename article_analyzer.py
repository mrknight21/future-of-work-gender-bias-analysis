import spacy
from fastcoref import spacy_component
from transformers import pipeline
import nltk

def initialise_pipelines(config):
    nlp = spacy.load('en_core_web_trf')
    nlp.add_pipe("fastcoref")

def analyse_article(article, pipeline):
    # sents = nltk.tokenize.sent_tokenize(article)
    entities = []
    existing_entities = {"it": None, 'he': None, "she": None, "they": None}
    doc = nlp(article)
    for sent in doc.sents:
        if len(sent.ents) > 0:
            sentiment = 0
            # for ent in sent.ents:



    # for sent in sents:
    #     doc = nlp(sent)
    #     coref_clusters = doc._.coref_clusters








if __name__ == "__main__":

    config = {
        "spacy_model": 'en_core_web_trf',
        "coref": "fastcoref",
        "sentiment_analysis_model": "siebert/sentiment-roberta-large-english",
    }

    # Test gender prediction on a list of names (requires connection to MongoDB)
    article1 = "Australian workers are exhausted, unwell, at risk of quitting, and largely unprepared for future workplace challenges driven by automation and artificial intelligence, a new report from the University of Melbourne Work Futures Hallmark Research Initiative reveals. A comprehensive survey of 1,400 Australian workers fielded in June 2022 asked about their experiences at work since the onset of the COVID-19 pandemic. The findings, published in the 2023 State of the Future of Work Report, reveals Australian workers were in poorer physical and mental health since the pandemic began, with prime aged workers (between 25-55 years of age) significantly impacted, one third of whom had considered quitting. Report co-author and sociologist Dr Brendan Churchill said: “With high rates of fatigue and exhaustion among younger and middle-aged workers, it’s no surprise that over a third of prime aged workers in Australia are considering quitting their jobs. “Australian workplaces must prioritise workers’ well-being into the recovery to provide greater support in addressing burnout and mental distress.” Automation and the use of AI are expected to have a major impact on the ways Australians work in the future, including the arrival of ChatGPT, which can write language with human-like efficiencies. AI advances are poised to reduce human decision-making, but the report found Australian workers are largely unprepared for these challenges. Report co-author and human geographer Professor David Bissell said: “We found that most Australians aren’t too worried about being replaced by AI and automation at work, and believe that their skills are adequate to meet the challenges ahead. “However, our research shows that Australians are cautious adopters of new technologies in the workplace. One-in-five say they only adopt new technologies in the workplace when they are forced to, so we need to understand the reasons behind this and facilitate technology use that is inclusive to all”. The pandemic severely impacted caregivers - people providing care for others in their lives - citing school closures, working from home and reduced access to outsourced care as additional stressors to working in a challenging pandemic environment. Working caregivers are more likely to be dissatisfied with their jobs and consider quitting than non-caregiver counterparts. Four in 10 working caregivers believe their career opportunities are limited. Report co-author and gender inequality expert Professor Leah Ruppanner said: “Caregivers are working harder than before the pandemic, and they’re at risk of workplace attrition. We often focus on women caregivers, but our report finds that caregiving men are also exhausted, less productive, and seeing fewer opportunities for advancement. “Workplaces must take a more holistic approach to caregiving including ensuring men also have access to flexible work and employment policies”. Thirty eight per cent of workers said they had a chronic illness – higher than the 32 per cent found in the most recent Australian Census in 2021 – which researchers said may reflect the emergence of Long COVID and the growing mental distress of working during the pandemic. Over 40 per cent of people with a chronic illness want to quit their jobs. Almost three-quarters of workers with a chronic illness said their illness is made worse by their job. The report also found discrimination at work is more widespread than previously identified. Discrimination remains pervasive, particularly against women, people with chronic illnesses and caregivers, and Aboriginal and Torres Strait Islander people. Almost two-thirds of Aboriginal and Torres Strait Islander respondents said they were turned down for a job because they were Indigenous. Those with chronic illness report similar rates of being turned down because of their illness. Despite the bleak findings, Australian workers found flexible ways of working required during the pandemic made them happier and more productive, and the majority say ongoing flexible work arrangements are critical to their staying with their current employers. Professor Leah Ruppanner said: “There’s this flawed assumption that in-person work was ideal for most prior to the pandemic – but for mothers, caregivers and people living with chronic illnesses, it wasn’t. “A return to normal is a return to unequal employment experiences and outcomes for these groups. The pandemic has highlighted the personal and professional benefits of flexible and remote ways of working for many, and it’s clear that most Australian workers don’t want to go back to a ‘traditional’ work environment.” The report calls for governments to improve Australia’s preparedness for the future of work by providing free universal high-quality childcare; legislating workers’ access to flexible and remote work as a workplace right consistent with other OECD nations; and providing equal access to technological upskilling, especially for traditionally underrepresented groups - to respond to the demographic, technological and geographic changes facing Australia."
    article2 = "The world of work is constantly changing. Concepts that our parents or grandparents grew up with, such as the nine-to-five office and the job-for-life, are being consigned to the past. Technology is clearly a driver behind much of this. However, societal changes such as aging populations in many developed countries and a growing understanding of the environmental impact of working practices are important factors, too. In 2024, we can expect to see further development of many of the trends that have reshaped our working lives in recent years. However, the impact of breakthrough technologies (particularly AI) will be felt more keenly than ever as the rate of adoption accelerates. This wave of digitization and transformation will affect everyone, even those outside of the high-tech industries and tech-focused roles where it is already the norm. This set of trends focuses on changes that will impact our working lives on a day-to-day basis. Look at it as a heads-up for those who want to get ahead. Or for bosses or managers, it can be thought of as pointers for where to focus your efforts to ensure your workforce is ready to face the biggest challenges of 2024. Generative AI. This is probably the big one. There’s a popular line of thought today that AI won’t replace jobs – but people who can use AI will replace people who can’t. Generative AI tools are quickly evolving to the point where they offer solutions that can increase efficiency in just about any task or line of work. But remember – a big part of becoming a proficient AI-augmented worker is understanding its limitations and knowing where you still need to apply human creativity, compassion and innovation! Sustainable Working Practices. In my opinion, this is the most important area in which we have to make conscious changes to our behavior. Understanding and reducing the impact of our actions on our environment and planet requires rethinking many aspects of our working lives, from where we work to how we create and implement circular processes that reduce wastage and encourage recycling and re-use of resources. Future Skills. As technology transforms more areas of work and business, ensuring we’re equipped to use it effectively is a priority for us all, from understanding the importance of data-driven decision-making to developing an awareness of cyber threats, developing emotional intelligence and empathy to counter for technology’s lack of it, and adopting the shift in mindset needed to work or lead effectively when your team is spread around the world. Perhaps no one can be expected to affect all of these changes, but understanding which are relevant to your role and responsibilities is the key. Employee Experience. Organizations understand that today, customer experience is key to developing lifelong relationships and generating recurring business. Equally so, they are starting to understand the importance of ensuring that workers are satisfied across the board rather than just adequately remunerated. This takes in work/life balance, wellness, intellectual challenge, and personal growth and development. In 2024, if your employer doesn’t come up to scratch here, it should become increasingly easy to find one that does. Changing Workplace Demographics Populations are aging, international migration is increasing, workers' skills are being boosted up the chain of command, and organizations are increasingly aware of the value that diversity and inclusion bring to any workforce. All of these shifts mean that traditional hierarchies are being shaken up, and traditional ideas about who our co-workers might be are going out of the window in 2024 and beyond. The tolerance for anachronisms such as the gender pay gap will decline, and factors such as age, race or even level of traditional educational attainment will be less of a barrier to progression. Those who are flexible in the face of this change will not be short of opportunities.Digitization and Datafication of Work. In 2024, data impacts every aspect of our working lives – from the metrics that are used to assess productivity to the information we leverage to make better decisions and implement more efficient processes. For those who want to make their mark, a basic ability to knock together a spreadsheet in Excel isn’t going to cut it in 2024. Understanding how to use data to assist our day-to-day tasks doesn’t mean studying for a degree in data science, but it does mean having an overview of the tools and platforms that are becoming available and learning how to spot opportunities to use them. Lifelong Learning. With today’s pace of change, education can no longer be thought of as a process we go through in youth that will equip us with skills for life. Businesses will require workforces to take part in ongoing training in order to keep skills up-to-date or reskill in emerging technologies, particularly those involving data and AI. A diverse range of opportunities mainly focused on online learning, will be available for those who want to take the initiative and ensure they are personally equipped for the future. The Decentralized Workplace. Remote working was a necessity for many of us during the Covid-19 pandemic. Today, we might choose it because we prefer the benefits it brings to work/life balance, or we’re more productive without wasting time (and money) commuting. Or because we want to leverage the ability to build a truly globalized and decentralized workforce. In 2024, more of us will choose hybrid working arrangements, combining the collaborative and cultural benefits of face-to-face co-working with the flexibility of remote working."
    article3 = "The world of work is changing rapidly. Estimates suggest that by as early as 2025, employers will divide work equally between human beings and machines, disrupting 85 million jobs globally. A move towards automation and outsourcing is in direct contrast to the political dialogue, which has framed employment as the antidote to poverty. Most people assume that employment with good working conditions is good for health: it offers connection, community, and purpose. Sustainable Development Goal 8 calls for achieving full and productive employment and decent work for all by 2030. But this goal may be in jeopardy. In the book A World Without Work, Daniel Susskind argues that—despite historical concerns over technological unemployment being misguided—policy makers should be taking much more seriously the prospect of a world with far less work. What would the consequences of such a world be for health? The answer is not simple. A three-paper Series published in The Lancet starts to explore the relationship between work and health. The major message is that work and employment are an underutilised lever to influence population health. Just as schools are considered as a place of health creation for young people, so might working environments serve for the working population. But the Series also highlights that the health community has been too focused on narrow occupational hazards and not on work as a social determinant of health. The first paper in the Series aims to correct this situation and identifies six emerging challenges, including the influence of technology on the nature of work and the looming threat of the effect of climate change on work. A narrow and reductive view of work is also reflected in how governments tend to collect data on employment. They often focus solely on the binary question of whether people are employed or not, rather than on the conditions of that employment. A Comment by Pega and colleagues accompanies the Series and highlights the collaboration between the International Labour Organization (ILO) and WHO, and their efforts to collect a much more capacious set of data. Such data will be crucial because context is everything when it comes to understanding the relationship between work and health. An umbrella review undertaken in the second paper of the Series explores work-related causes of mental health conditions and has some striking findings. For example, the job strain model (a combination of high job demand and low job control) is the model most robustly associated with the onset of depressive disorders. Among the specific working conditions assessed, exposure to workplace bullying is associated with the greatest risk of depressive disorders. A life course perspective, taken in the third paper in the Series, shows that the influence of retirement on health remains unclear. Retirement seems to benefit the health of workers in some jobs, but the effect on health is less clear and might even be negative among higher-educated workers with high job satisfaction. A study in the USA demonstrated that unemployment was associated with a 2·7 times higher risk of reporting poor health. Having more state unemployment benefits reduced this adverse effect among men but not among women. Overall, the authors of the Series conclude that being in paid employment is associated with better health. Marjorie Kelly describes a new “manifest destiny” in her book Wealth Supremacy: How the Extractive Economy and the Biased Rules of Capitalism Drive Today's Crises, in which a decades-long war against workers has been waged, defined by the destruction of unions, the transfer of 40% of all workers in the USA to a contingent workforce with precarious and less healthy conditions, and culminating in the disappearance of jobs altogether through automation. What should the health community be doing about it? The Series has some useful recommendations, including advocating for governments to hold employers responsible for good working conditions, and designing and evaluating workplace interventions to mitigate the emerging threats to workers’ health. If jobs that are high demand and low control were automated it might result in less work but perhaps more fulfilling jobs that are fairly distributed. But this change will not happen on its own. And it will not happen in isolation. The health community must meaningfully engage with other sectors and organisations, such as the ILO and unions, to consider the speed of automation and advocate for accelerating the evaluation of large-scale initiatives including universal basic income and credit that might offer a way to protect health. A new world with less work must be imagined and the health community must be central in its construction."
    nlp = spacy.load('en_core_web_trf')
    nlp.add_pipe("fastcoref")
    sentiment_analysis = pipeline("sentiment-analysis", model="siebert/sentiment-roberta-large-english")
    print(sentiment_analysis("I love this!"))
    result = analyse_article(article1, nlp)
    print(result)